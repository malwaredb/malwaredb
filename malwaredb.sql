--
-- PostgreSQL database dump
--

-- Dumped from database version 9.5.12
-- Dumped by pg_dump version 9.5.12

-- Started on 2018-05-08 22:14:05 EDT

SET statement_timeout = 0;
SET lock_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET client_min_messages = warning;
SET row_security = off;

--
-- TOC entry 2232 (class 1262 OID 16408)
-- Name: malwaredb; Type: DATABASE; Schema: -; Owner: postgres
--

CREATE DATABASE malwaredb WITH TEMPLATE = template0 ENCODING = 'UTF8' LC_COLLATE = 'en_US.UTF-8' LC_CTYPE = 'en_US.UTF-8';


ALTER DATABASE malwaredb OWNER TO postgres;

\connect malwaredb

SET statement_timeout = 0;
SET lock_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET client_min_messages = warning;
SET row_security = off;

--
-- TOC entry 1 (class 3079 OID 12393)
-- Name: plpgsql; Type: EXTENSION; Schema: -; Owner: 
--

CREATE EXTENSION IF NOT EXISTS plpgsql WITH SCHEMA pg_catalog;


--
-- TOC entry 2235 (class 0 OID 0)
-- Dependencies: 1
-- Name: EXTENSION plpgsql; Type: COMMENT; Schema: -; Owner: 
--

COMMENT ON EXTENSION plpgsql IS 'PL/pgSQL procedural language';


--
-- TOC entry 195 (class 1255 OID 16534)
-- Name: lzjd_compare(text, text); Type: FUNCTION; Schema: public; Owner: rjzak
--

CREATE FUNCTION public.lzjd_compare(text, text) RETURNS integer
    LANGUAGE c
    AS 'lzjd_psql.so', 'pg_lzjd_compare';


ALTER FUNCTION public.lzjd_compare(text, text) OWNER TO rjzak;

--
-- TOC entry 184 (class 1259 OID 16450)
-- Name: file_id_seq; Type: SEQUENCE; Schema: public; Owner: rjzak
--

CREATE SEQUENCE public.file_id_seq
    START WITH 0
    INCREMENT BY 1
    MINVALUE 0
    NO MAXVALUE
    CACHE 1;


ALTER TABLE public.file_id_seq OWNER TO rjzak;

SET default_tablespace = '';

SET default_with_oids = false;

--
-- TOC entry 181 (class 1259 OID 16410)
-- Name: file; Type: TABLE; Schema: public; Owner: rjzak
--

CREATE TABLE public.file (
    id bigint DEFAULT nextval('public.file_id_seq'::regclass) NOT NULL,
    sha1 text NOT NULL,
    sha256 text NOT NULL,
    sha512 text NOT NULL,
    md5 text NOT NULL,
    ssdeep text,
    sdhash text,
    lzjd text,
    pehash text,
    imphash text
);


ALTER TABLE public.file OWNER TO rjzak;

--
-- TOC entry 186 (class 1259 OID 16454)
-- Name: file_filename_id_seq; Type: SEQUENCE; Schema: public; Owner: rjzak
--

CREATE SEQUENCE public.file_filename_id_seq
    START WITH 0
    INCREMENT BY 1
    MINVALUE 0
    NO MAXVALUE
    CACHE 1;


ALTER TABLE public.file_filename_id_seq OWNER TO rjzak;

--
-- TOC entry 183 (class 1259 OID 16433)
-- Name: file_filename_xref; Type: TABLE; Schema: public; Owner: rjzak
--

CREATE TABLE public.file_filename_xref (
    id bigint DEFAULT nextval('public.file_filename_id_seq'::regclass) NOT NULL,
    file_id bigint NOT NULL,
    filename_id bigint NOT NULL
);


ALTER TABLE public.file_filename_xref OWNER TO rjzak;

--
-- TOC entry 194 (class 1259 OID 16522)
-- Name: filemagic_id_seq; Type: SEQUENCE; Schema: public; Owner: rjzak
--

CREATE SEQUENCE public.filemagic_id_seq
    START WITH 0
    INCREMENT BY 1
    MINVALUE 0
    NO MAXVALUE
    CACHE 1;


ALTER TABLE public.filemagic_id_seq OWNER TO rjzak;

--
-- TOC entry 193 (class 1259 OID 16514)
-- Name: filemagic; Type: TABLE; Schema: public; Owner: rjzak
--

CREATE TABLE public.filemagic (
    id bigint DEFAULT nextval('public.filemagic_id_seq'::regclass) NOT NULL,
    filetype_id bigint NOT NULL,
    magic bytea NOT NULL,
    "offset" integer DEFAULT 0 NOT NULL,
    offsetmax integer DEFAULT 6 NOT NULL
);


ALTER TABLE public.filemagic OWNER TO rjzak;

--
-- TOC entry 185 (class 1259 OID 16452)
-- Name: filename_id_seq; Type: SEQUENCE; Schema: public; Owner: rjzak
--

CREATE SEQUENCE public.filename_id_seq
    START WITH 0
    INCREMENT BY 1
    MINVALUE 0
    NO MAXVALUE
    CACHE 1;


ALTER TABLE public.filename_id_seq OWNER TO rjzak;

--
-- TOC entry 182 (class 1259 OID 16423)
-- Name: filename; Type: TABLE; Schema: public; Owner: rjzak
--

CREATE TABLE public.filename (
    id bigint DEFAULT nextval('public.filename_id_seq'::regclass) NOT NULL,
    filename text NOT NULL
);


ALTER TABLE public.filename OWNER TO rjzak;

--
-- TOC entry 192 (class 1259 OID 16504)
-- Name: filetype_id_seq; Type: SEQUENCE; Schema: public; Owner: rjzak
--

CREATE SEQUENCE public.filetype_id_seq
    START WITH 0
    INCREMENT BY 1
    MINVALUE 0
    NO MAXVALUE
    CACHE 1;


ALTER TABLE public.filetype_id_seq OWNER TO rjzak;

--
-- TOC entry 191 (class 1259 OID 16498)
-- Name: filetype; Type: TABLE; Schema: public; Owner: rjzak
--

CREATE TABLE public.filetype (
    id bigint DEFAULT nextval('public.filetype_id_seq'::regclass) NOT NULL,
    name text,
    "desc" text NOT NULL,
    executable boolean NOT NULL
);


ALTER TABLE public.filetype OWNER TO rjzak;

--
-- TOC entry 188 (class 1259 OID 16467)
-- Name: user_id_seq; Type: SEQUENCE; Schema: public; Owner: rjzak
--

CREATE SEQUENCE public.user_id_seq
    START WITH 0
    INCREMENT BY 1
    MINVALUE 0
    NO MAXVALUE
    CACHE 1;


ALTER TABLE public.user_id_seq OWNER TO rjzak;

--
-- TOC entry 187 (class 1259 OID 16461)
-- Name: user; Type: TABLE; Schema: public; Owner: rjzak
--

CREATE TABLE public."user" (
    id bigint DEFAULT nextval('public.user_id_seq'::regclass) NOT NULL,
    username text NOT NULL,
    password bytea NOT NULL,
    apikey text,
    email text NOT NULL
);


ALTER TABLE public."user" OWNER TO rjzak;

--
-- TOC entry 190 (class 1259 OID 16495)
-- Name: user_file_id_seq; Type: SEQUENCE; Schema: public; Owner: rjzak
--

CREATE SEQUENCE public.user_file_id_seq
    START WITH 0
    INCREMENT BY 1
    MINVALUE 0
    NO MAXVALUE
    CACHE 1;


ALTER TABLE public.user_file_id_seq OWNER TO rjzak;

--
-- TOC entry 189 (class 1259 OID 16478)
-- Name: user_file_xref; Type: TABLE; Schema: public; Owner: rjzak
--

CREATE TABLE public.user_file_xref (
    id bigint DEFAULT nextval('public.user_file_id_seq'::regclass) NOT NULL,
    file_id bigint NOT NULL,
    user_id bigint NOT NULL
);


ALTER TABLE public.user_file_xref OWNER TO rjzak;

--
-- TOC entry 2082 (class 2606 OID 16437)
-- Name: file_filename_pk; Type: CONSTRAINT; Schema: public; Owner: rjzak
--

ALTER TABLE ONLY public.file_filename_xref
    ADD CONSTRAINT file_filename_pk PRIMARY KEY (id);


--
-- TOC entry 2074 (class 2606 OID 16414)
-- Name: file_pk; Type: CONSTRAINT; Schema: public; Owner: rjzak
--

ALTER TABLE ONLY public.file
    ADD CONSTRAINT file_pk PRIMARY KEY (id);


--
-- TOC entry 2076 (class 2606 OID 16419)
-- Name: file_sha512_unique; Type: CONSTRAINT; Schema: public; Owner: rjzak
--

ALTER TABLE ONLY public.file
    ADD CONSTRAINT file_sha512_unique UNIQUE (sha512);


--
-- TOC entry 2106 (class 2606 OID 16526)
-- Name: filemagic_pkey; Type: CONSTRAINT; Schema: public; Owner: rjzak
--

ALTER TABLE ONLY public.filemagic
    ADD CONSTRAINT filemagic_pkey PRIMARY KEY (id);


--
-- TOC entry 2078 (class 2606 OID 16432)
-- Name: filename_name_unique; Type: CONSTRAINT; Schema: public; Owner: rjzak
--

ALTER TABLE ONLY public.filename
    ADD CONSTRAINT filename_name_unique UNIQUE (filename);


--
-- TOC entry 2080 (class 2606 OID 16430)
-- Name: filename_pk; Type: CONSTRAINT; Schema: public; Owner: rjzak
--

ALTER TABLE ONLY public.filename
    ADD CONSTRAINT filename_pk PRIMARY KEY (id);


--
-- TOC entry 2098 (class 2606 OID 16512)
-- Name: filetype_desc_unique; Type: CONSTRAINT; Schema: public; Owner: rjzak
--

ALTER TABLE ONLY public.filetype
    ADD CONSTRAINT filetype_desc_unique UNIQUE ("desc");


--
-- TOC entry 2101 (class 2606 OID 16510)
-- Name: filetype_name_unique; Type: CONSTRAINT; Schema: public; Owner: rjzak
--

ALTER TABLE ONLY public.filetype
    ADD CONSTRAINT filetype_name_unique UNIQUE (name);


--
-- TOC entry 2103 (class 2606 OID 16508)
-- Name: filetype_pkey; Type: CONSTRAINT; Schema: public; Owner: rjzak
--

ALTER TABLE ONLY public.filetype
    ADD CONSTRAINT filetype_pkey PRIMARY KEY (id);


--
-- TOC entry 2088 (class 2606 OID 16475)
-- Name: user_email_unique; Type: CONSTRAINT; Schema: public; Owner: rjzak
--

ALTER TABLE ONLY public."user"
    ADD CONSTRAINT user_email_unique UNIQUE (email);


--
-- TOC entry 2096 (class 2606 OID 16482)
-- Name: user_file_pkey; Type: CONSTRAINT; Schema: public; Owner: rjzak
--

ALTER TABLE ONLY public.user_file_xref
    ADD CONSTRAINT user_file_pkey PRIMARY KEY (id);


--
-- TOC entry 2090 (class 2606 OID 16471)
-- Name: user_pk; Type: CONSTRAINT; Schema: public; Owner: rjzak
--

ALTER TABLE ONLY public."user"
    ADD CONSTRAINT user_pk PRIMARY KEY (id);


--
-- TOC entry 2092 (class 2606 OID 16473)
-- Name: user_username_unique; Type: CONSTRAINT; Schema: public; Owner: rjzak
--

ALTER TABLE ONLY public."user"
    ADD CONSTRAINT user_username_unique UNIQUE (username);


--
-- TOC entry 2068 (class 1259 OID 16460)
-- Name: file_idx_imphash; Type: INDEX; Schema: public; Owner: rjzak
--

CREATE INDEX file_idx_imphash ON public.file USING btree (imphash) WHERE (imphash IS NOT NULL);


--
-- TOC entry 2069 (class 1259 OID 16422)
-- Name: file_idx_md5; Type: INDEX; Schema: public; Owner: rjzak
--

CREATE INDEX file_idx_md5 ON public.file USING btree (md5) WHERE (md5 IS NOT NULL);


--
-- TOC entry 2070 (class 1259 OID 16459)
-- Name: file_idx_pehash; Type: INDEX; Schema: public; Owner: rjzak
--

CREATE INDEX file_idx_pehash ON public.file USING btree (pehash) WHERE (pehash IS NOT NULL);


--
-- TOC entry 2071 (class 1259 OID 16420)
-- Name: file_idx_sha1; Type: INDEX; Schema: public; Owner: rjzak
--

CREATE INDEX file_idx_sha1 ON public.file USING btree (sha1) WHERE (sha1 IS NOT NULL);


--
-- TOC entry 2072 (class 1259 OID 16421)
-- Name: file_idx_sha256; Type: INDEX; Schema: public; Owner: rjzak
--

CREATE INDEX file_idx_sha256 ON public.file USING btree (sha256) WHERE (sha256 IS NOT NULL);


--
-- TOC entry 2104 (class 1259 OID 16533)
-- Name: filemagic_idx_bytes; Type: INDEX; Schema: public; Owner: rjzak
--

CREATE INDEX filemagic_idx_bytes ON public.filemagic USING btree (magic) WHERE (magic IS NOT NULL);


--
-- TOC entry 2099 (class 1259 OID 16513)
-- Name: filetype_idx_exec; Type: INDEX; Schema: public; Owner: rjzak
--

CREATE INDEX filetype_idx_exec ON public.filetype USING btree (executable) WHERE (executable IS NOT NULL);


--
-- TOC entry 2083 (class 1259 OID 16443)
-- Name: fki_file_filename_file_fkey; Type: INDEX; Schema: public; Owner: rjzak
--

CREATE INDEX fki_file_filename_file_fkey ON public.file_filename_xref USING btree (file_id);


--
-- TOC entry 2084 (class 1259 OID 16449)
-- Name: fki_file_filename_filename_fkey; Type: INDEX; Schema: public; Owner: rjzak
--

CREATE INDEX fki_file_filename_filename_fkey ON public.file_filename_xref USING btree (filename_id);


--
-- TOC entry 2107 (class 1259 OID 16532)
-- Name: fki_filemagic_filetype_fkey; Type: INDEX; Schema: public; Owner: rjzak
--

CREATE INDEX fki_filemagic_filetype_fkey ON public.filemagic USING btree (filetype_id);


--
-- TOC entry 2093 (class 1259 OID 16494)
-- Name: fki_user_file_file_fkey; Type: INDEX; Schema: public; Owner: rjzak
--

CREATE INDEX fki_user_file_file_fkey ON public.user_file_xref USING btree (file_id);


--
-- TOC entry 2094 (class 1259 OID 16488)
-- Name: fki_user_file_user_fkey; Type: INDEX; Schema: public; Owner: rjzak
--

CREATE INDEX fki_user_file_user_fkey ON public.user_file_xref USING btree (user_id);


--
-- TOC entry 2085 (class 1259 OID 16477)
-- Name: user_apikey_null_unique; Type: INDEX; Schema: public; Owner: rjzak
--

CREATE UNIQUE INDEX user_apikey_null_unique ON public."user" USING btree ((COALESCE(apikey, ''::text))) WHERE (apikey IS NULL);


--
-- TOC entry 2086 (class 1259 OID 16476)
-- Name: user_apikey_unqiue; Type: INDEX; Schema: public; Owner: rjzak
--

CREATE UNIQUE INDEX user_apikey_unqiue ON public."user" USING btree (apikey) WHERE (apikey IS NOT NULL);


--
-- TOC entry 2108 (class 2606 OID 16438)
-- Name: file_filename_file_fkey; Type: FK CONSTRAINT; Schema: public; Owner: rjzak
--

ALTER TABLE ONLY public.file_filename_xref
    ADD CONSTRAINT file_filename_file_fkey FOREIGN KEY (file_id) REFERENCES public.file(id);


--
-- TOC entry 2109 (class 2606 OID 16444)
-- Name: file_filename_filename_fkey; Type: FK CONSTRAINT; Schema: public; Owner: rjzak
--

ALTER TABLE ONLY public.file_filename_xref
    ADD CONSTRAINT file_filename_filename_fkey FOREIGN KEY (filename_id) REFERENCES public.filename(id);


--
-- TOC entry 2112 (class 2606 OID 16527)
-- Name: filemagic_filetype_fkey; Type: FK CONSTRAINT; Schema: public; Owner: rjzak
--

ALTER TABLE ONLY public.filemagic
    ADD CONSTRAINT filemagic_filetype_fkey FOREIGN KEY (filetype_id) REFERENCES public.filetype(id);


--
-- TOC entry 2111 (class 2606 OID 16489)
-- Name: user_file_file_fkey; Type: FK CONSTRAINT; Schema: public; Owner: rjzak
--

ALTER TABLE ONLY public.user_file_xref
    ADD CONSTRAINT user_file_file_fkey FOREIGN KEY (file_id) REFERENCES public.file(id);


--
-- TOC entry 2110 (class 2606 OID 16483)
-- Name: user_file_user_fkey; Type: FK CONSTRAINT; Schema: public; Owner: rjzak
--

ALTER TABLE ONLY public.user_file_xref
    ADD CONSTRAINT user_file_user_fkey FOREIGN KEY (user_id) REFERENCES public."user"(id);


--
-- TOC entry 2234 (class 0 OID 0)
-- Dependencies: 6
-- Name: SCHEMA public; Type: ACL; Schema: -; Owner: postgres
--

REVOKE ALL ON SCHEMA public FROM PUBLIC;
REVOKE ALL ON SCHEMA public FROM postgres;
GRANT ALL ON SCHEMA public TO postgres;
GRANT ALL ON SCHEMA public TO PUBLIC;


-- Completed on 2018-05-08 22:14:05 EDT

--
-- PostgreSQL database dump complete
--

